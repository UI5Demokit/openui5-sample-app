/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/changeHandler/BaseAddViaDelegate"],function(e){"use strict";var r="sap.ui.core.Title";var t="sap.m.Toolbar";var n="sap.m.Label";var a="sap.ui.comp.smartfield.SmartLabel";function o(e,o){var i=o.change;var l=o.modifier;var v=i.getContent();var g=v.newFieldIndex;var u=i.getDependentControl("targetContainerHeader",o);var d=e.indexOf(u);var c=0;var f=0;if(e.length===1||e.length===d+1){c=e.length}else{var s=0;for(s=d+1;s<e.length;s++){var p=l.getControlType(e[s]);if(p===n||p===a){if(f==g){c=s;break}f++}if(p===r||p===t){c=s;break}if(s===e.length-1){c=e.length}}}return c}function i(e,r,t){var n=e.slice();n.splice(r,0,t.label,t.control);return n}function l(e,r,t,n){return r.reduce(function(r,a,o){return r.then(function(){return t.insertAggregation(e,"content",a,o,n.view)})},Promise.resolve())}var v=e.createAddViaDelegateChangeHandler({addProperty:function(e){var r=e.control;var t=e.innerControls;var n=e.modifier;var a=e.appComponent;var v;var g;var u;var d=e.change;var c=d.getRevertData();c.labelSelector=n.getSelector(t.label,a);return Promise.resolve().then(n.getAggregation.bind(n,r,"content")).then(function(a){v=a;g=o(v,e);u=i(v,g,t);return n.removeAllAggregation(r,"content")}).then(function(){return l(r,u,n,e)}).then(function(){if(t.valueHelp){return n.insertAggregation(r,"dependents",t.valueHelp,0,e.view)}return undefined})},revertAdditionalControls:function(e){var r=e.control;var t=e.change;var n=e.modifier;var a=e.appComponent;var o=t.getRevertData().labelSelector;if(o){var i=n.bySelector(o,a);return Promise.resolve().then(n.removeAggregation.bind(n,r,"content",i)).then(n.destroy.bind(n,i))}return Promise.resolve()},aggregationName:"content",mapParentIdIntoChange:function(e,r,t){var n=t.appComponent;var a=t.view;var o=t.modifier.bySelector(r.parentId,n,a);var i=o.getTitle()||o.getToolbar();if(i){e.addDependentControl(i.getId(),"targetContainerHeader",t)}},parentAlias:"_",fieldSuffix:"",skipCreateLayout:true,supportsDefault:true});return v},true);