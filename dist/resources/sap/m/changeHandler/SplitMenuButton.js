/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/util/reflection/JsControlTreeModifier","sap/ui/core/Component","sap/ui/fl/util/ManagedObjectModel"],function(e,t){"use strict";var n={};var r="sourceControl";n.applyChange=function(e,t,n){if(n.modifier.targets!=="jsControlTree"){return Promise.reject(new Error("Split change can't be applied on XML tree"))}var o=e.getDefinition();var a=n.modifier;var i=n.view;var u=n.appComponent;var s=e.getDependentControl(r,n);var c;var g;var d;var l;var p;var f;var v;var m;var h;return Promise.resolve().then(function(){return a.getAggregation(s,"menu")}).then(function(e){c=e;return a.getAggregation(c,"items")}).then(function(e){g=e;h=a.getParent(s);return a.getParentAggregationName(s,h)}).then(function(e){d=e;return a.findIndexInParentAggregation(s)}).then(function(e){l=e;p=o.content.newElementIds;f={parentAggregation:d,insertIndex:l,insertedButtons:[]};return g.reduce(function(e,t,n){var r;var o;var s;return e.then(function(){o=n;r=p[o];return a.createControl("sap.m.Button",u,i,r)}).then(function(e){s=e;f.insertedButtons.push(r);v="$sap.m.flexibility.SplitButtonsModel";return a.createControl("sap.ui.fl.util.ManagedObjectModel",u,i,Object.assign({},r,{id:r.id+"-managedObjectModel"}),{object:t,name:v})}).then(function(e){m=e;return a.insertAggregation(s,"dependents",m,0,i)}).then(function(){a.bindProperty(s,"text",v+">/text");a.bindProperty(s,"icon",v+">/icon");a.bindProperty(s,"enabled",v+">/enabled");a.bindProperty(s,"visible",v+">/visible");return a.bindAggregation(s,"customData",{path:v+">/customData",template:a.createControl("sap.ui.core.CustomData",u,i,Object.assign({},r,{id:r.id+"-customData"}),{key:{path:v+">key"},value:{path:v+">value"}}),templateShareable:false})}).then(function(){return a.attachEvent(s,"press","sap.m.changeHandler.SplitMenuButton.pressHandler",{selector:a.getSelector(t,u),appComponentId:u.getId()})}).then(function(){return a.insertAggregation(h,d,s,l+o,i)})},Promise.resolve())}).then(function(){return Promise.resolve().then(a.removeAggregation.bind(a,h,d,s)).then(a.insertAggregation.bind(a,h,"dependents",s,0,i)).then(function(){e.setRevertData(f)})})};n.revertChange=function(e,t,n){var o=n.modifier;var a=e.getRevertData();var i=e.getDependentControl(r,n);var u=n.appComponent;var s=n.view;var c=o.getParent(i);var g=a.parentAggregation;var d=a.insertIndex;var l=[];return Promise.resolve().then(function(){a.insertedButtons.forEach(function(e){l.push(o.bySelector(e,u,s))});return l.reduce(function(e,t){return e.then(function(){return o.removeAggregation(c,g,t)}).then(function(){return o.destroy(t)})},Promise.resolve())}).then(o.insertAggregation.bind(o,c,g,i,d,s)).then(function(){e.resetRevertData()})};n.completeChangeContent=function(e,t,n){var o=n.modifier;var a=n.appComponent;var i=e.getDefinition();if(!t.newElementIds){throw new Error("Split of MenuButton cannot be applied : oSpecificChangeInfo.newElementIds attribute required")}if(!t.sourceControlId){throw new Error("Split of MenuButton cannot be applied : oSpecificChangeInfo.sourceControlId attribute required")}e.addDependentControl(t.sourceControlId,r,n);i.content.sourceSelector=o.getSelector(t.sourceControlId,a);i.content.newElementIds=t.newElementIds.map(function(e){return o.getSelector(e,a)})};n.pressHandler=function(n,r){var o=e.bySelector(r.selector,t.get(r.appComponentId));o.firePress()};return n},true);